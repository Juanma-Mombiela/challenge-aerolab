{"ast":null,"code":"import _regeneratorRuntime from\"/home/jmombiela/proyectos/challenge-aerolab/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/jmombiela/proyectos/challenge-aerolab/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/jmombiela/proyectos/challenge-aerolab/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/jmombiela/proyectos/challenge-aerolab/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,createContext,useEffect}from\"react\";import{api}from\"../api/api\";import Swal from\"sweetalert2\";import LoadingPage from\"../components/LoadingPage\";import{jsx as _jsx}from\"react/jsx-runtime\";export var UserContext=/*#__PURE__*/createContext();export var UserProvider=function UserProvider(props){var _useState=useState(),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),pointsLoading=_useState6[0],setPointsLoading=_useState6[1];var handleAddPoints=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(pointsToAdd){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setPointsLoading(true);return _context.abrupt(\"return\",api.addPoints(pointsToAdd).then(function(res){setUser(_objectSpread(_objectSpread({},user),{},{points:res[\"New Points\"]}));setPointsLoading(false);}));case 2:case\"end\":return _context.stop();}}},_callee);}));return function handleAddPoints(_x){return _ref.apply(this,arguments);};}();var handleRedeem=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setPointsLoading(true);return _context2.abrupt(\"return\",api.redeem(id).then(function(_ref3){var message=_ref3.message,error=_ref3.error;if(message){api.getUser().then(function(user){return setUser(user);}).then(function(){setPointsLoading(false);Swal.fire({icon:\"success\",title:\"Product Buy!\",text:\"Wiiiii\"});});}else{Swal.fire({icon:\"error\",title:\"Crap...\",text:\"You can't redeem now, report with admin\",footer:error});setPointsLoading(false);}}));case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function handleRedeem(_x2){return _ref2.apply(this,arguments);};}();useEffect(function(){api.getUser().then(function(user){setUser(user);setPointsLoading(false);setLoading(false);});},[]);if(!user||loading){return/*#__PURE__*/_jsx(LoadingPage,{});}return/*#__PURE__*/_jsx(UserContext.Provider,{value:{user:user,addPoints:handleAddPoints,redeem:handleRedeem,pointsLoading:pointsLoading},children:props.children});};","map":{"version":3,"sources":["/home/jmombiela/proyectos/challenge-aerolab/src/context/UserContext.js"],"names":["React","useState","createContext","useEffect","api","Swal","LoadingPage","UserContext","UserProvider","props","user","setUser","loading","setLoading","pointsLoading","setPointsLoading","handleAddPoints","pointsToAdd","addPoints","then","res","points","handleRedeem","id","redeem","message","error","getUser","fire","icon","title","text","footer","children"],"mappings":"ooBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,aAA1B,CAAyCC,SAAzC,KAA0D,OAA1D,CACA,OAASC,GAAT,KAAoB,YAApB,CACA,MAAOC,CAAAA,IAAP,KAAiB,aAAjB,CACA,MAAOC,CAAAA,WAAP,KAAwB,2BAAxB,C,2CAEA,MAAO,IAAMC,CAAAA,WAAW,cAAGL,aAAa,EAAjC,CAEP,MAAO,IAAMM,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,KAAD,CAAW,eACbR,QAAQ,EADK,wCAC9BS,IAD8B,eACxBC,OADwB,8BAEPV,QAAQ,CAAC,IAAD,CAFD,yCAE9BW,OAF8B,eAErBC,UAFqB,8BAGKZ,QAAQ,CAAC,IAAD,CAHb,yCAG9Ba,aAH8B,eAGfC,gBAHe,eAKrC,GAAMC,CAAAA,eAAe,0FAAG,iBAAOC,WAAP,kHACtBF,gBAAgB,CAAC,IAAD,CAAhB,CADsB,gCAEfX,GAAG,CAACc,SAAJ,CAAcD,WAAd,EAA2BE,IAA3B,CAAgC,SAACC,GAAD,CAAS,CAC9CT,OAAO,gCAAMD,IAAN,MAAYW,MAAM,CAAED,GAAG,CAAC,YAAD,CAAvB,GAAP,CACAL,gBAAgB,CAAC,KAAD,CAAhB,CACD,CAHM,CAFe,wDAAH,kBAAfC,CAAAA,eAAe,4CAArB,CAQA,GAAMM,CAAAA,YAAY,2FAAG,kBAAOC,EAAP,sHACnBR,gBAAgB,CAAC,IAAD,CAAhB,CADmB,iCAEZX,GAAG,CAACoB,MAAJ,CAAWD,EAAX,EAAeJ,IAAf,CAAoB,eAAwB,IAArBM,CAAAA,OAAqB,OAArBA,OAAqB,CAAZC,KAAY,OAAZA,KAAY,CACjD,GAAID,OAAJ,CAAa,CACXrB,GAAG,CACAuB,OADH,GAEGR,IAFH,CAEQ,SAACT,IAAD,QAAUC,CAAAA,OAAO,CAACD,IAAD,CAAjB,EAFR,EAGGS,IAHH,CAGQ,UAAM,CACVJ,gBAAgB,CAAC,KAAD,CAAhB,CACAV,IAAI,CAACuB,IAAL,CAAU,CACRC,IAAI,CAAE,SADE,CAERC,KAAK,CAAE,cAFC,CAGRC,IAAI,CAAE,QAHE,CAAV,EAKD,CAVH,EAWD,CAZD,IAYO,CACL1B,IAAI,CAACuB,IAAL,CAAU,CACRC,IAAI,CAAE,OADE,CAERC,KAAK,CAAE,SAFC,CAGRC,IAAI,CAAE,yCAHE,CAIRC,MAAM,CAAEN,KAJA,CAAV,EAMAX,gBAAgB,CAAC,KAAD,CAAhB,CACD,CACF,CAtBM,CAFY,0DAAH,kBAAZO,CAAAA,YAAY,8CAAlB,CA2BAnB,SAAS,CAAC,UAAM,CACdC,GAAG,CAACuB,OAAJ,GAAcR,IAAd,CAAmB,SAACT,IAAD,CAAU,CAC3BC,OAAO,CAACD,IAAD,CAAP,CACAK,gBAAgB,CAAC,KAAD,CAAhB,CACAF,UAAU,CAAC,KAAD,CAAV,CACD,CAJD,EAKD,CANQ,CAMN,EANM,CAAT,CAQA,GAAI,CAACH,IAAD,EAASE,OAAb,CAAsB,CACpB,mBAAO,KAAC,WAAD,IAAP,CACD,CAED,mBACE,KAAC,WAAD,CAAa,QAAb,EACE,KAAK,CAAE,CACLF,IAAI,CAAJA,IADK,CAELQ,SAAS,CAAEF,eAFN,CAGLQ,MAAM,CAAEF,YAHH,CAILR,aAAa,CAAbA,aAJK,CADT,UAQGL,KAAK,CAACwB,QART,EADF,CAYD,CAhEM","sourcesContent":["import React, { useState, createContext, useEffect } from \"react\";\nimport { api } from \"../api/api\";\nimport Swal from \"sweetalert2\";\nimport LoadingPage from \"../components/LoadingPage\";\n\nexport const UserContext = createContext();\n\nexport const UserProvider = (props) => {\n  const [user, setUser] = useState();\n  const [loading, setLoading] = useState(true);\n  const [pointsLoading, setPointsLoading] = useState(true);\n\n  const handleAddPoints = async (pointsToAdd) => {\n    setPointsLoading(true);\n    return api.addPoints(pointsToAdd).then((res) => {\n      setUser({ ...user, points: res[\"New Points\"] });\n      setPointsLoading(false);\n    });\n  };\n\n  const handleRedeem = async (id) => {\n    setPointsLoading(true);\n    return api.redeem(id).then(({ message, error }) => {\n      if (message) {\n        api\n          .getUser()\n          .then((user) => setUser(user))\n          .then(() => {\n            setPointsLoading(false);\n            Swal.fire({\n              icon: \"success\",\n              title: \"Product Buy!\",\n              text: \"Wiiiii\",\n            });\n          });\n      } else {\n        Swal.fire({\n          icon: \"error\",\n          title: \"Crap...\",\n          text: \"You can't redeem now, report with admin\",\n          footer: error,\n        });\n        setPointsLoading(false);\n      }\n    });\n  };\n\n  useEffect(() => {\n    api.getUser().then((user) => {\n      setUser(user);\n      setPointsLoading(false);\n      setLoading(false);\n    });\n  }, []);\n\n  if (!user || loading) {\n    return <LoadingPage />;\n  }\n\n  return (\n    <UserContext.Provider\n      value={{\n        user,\n        addPoints: handleAddPoints,\n        redeem: handleRedeem,\n        pointsLoading,\n      }}\n    >\n      {props.children}\n    </UserContext.Provider>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}